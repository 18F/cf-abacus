'use strict';

// The JSON schemas we use to validate usage data and service definitions.

var schemas = require('..');

describe('abacus-metering-schemas', function () {
  describe('validate schema for a service resource definition', function () {
    it('validate a valid schema', function () {
      var service = {
        id: 'service-1',
        resources: [{
          name: 'Storage',
          units: [{
            'name': 'BYTE',
            quantityType: 'CURRENT'
          }]
        }, {
          name: 'LightApiCalls',
          units: [{
            name: 'LIGHT_API_CALL',
            quantityType: 'DELTA'
          }]
        }, {
          name: 'HeavyApiCalls',
          units: [{
            name: 'HEAVY_API_CALL',
            quantityType: 'DELTA'
          }]
        }],
        aggregations: [{
          id: 'STORAGE_PER_MONTH',
          unit: 'GIGABYTE',
          aggregationGroup: {
            name: 'monthly'
          },
          formula: 'MAX({BYTE}/1073741824)'
        }, {
          id: 'THOUSAND_LIGHT_API_CALLS_PER_MONTH',
          unit: 'LIGHT_API_CALL',
          aggregationGroup: {
            name: 'monthly'
          },
          formula: function formula(r) {
            return r.LIGHT_API_CALL / 1000;
          }
        }, {
          id: 'HEAVY_API_CALLS_PER_MONTH',
          unit: 'HEAVY_API_CALL',
          aggregationGroup: {
            name: 'monthly'
          },
          formula: 'SUM({HEAVY_API_CALL})',
          accumulate: function accumulate(a, qty) {
            return a ? a + qty : qty;
          },
          aggregate: function aggregate(a, qty) {
            return a ? a + qty : qty;
          }
        }]
      };

      expect(schemas.serviceDefinition.validate(service)).to.equal(service);
    });

    it('validate an invalid schema', function () {
      var service = {
        service_id: 'service-1',
        resources: [{
          name: 'Storage',
          units: [{
            'name': 'BYTE',
            quantityType: 'INVALID'
          }]
        }, {
          units: [{
            name: 'LIGHT_API_CALL',
            quantityType: 'DELTA'
          }]
        }, {
          name: 'HeavyApiCalls',
          units: [{
            quantityType: 'DELTA'
          }]
        }],
        aggregations: [{
          id: 'STORAGE_PER_MONTH',
          unit: 'GIGABYTE',
          aggregationGroup: {
            name: 'invalid'
          },
          formula: 'MAX({BYTE}/1073741824)'
        }, {
          unit: 'LIGHT_API_CALL',
          aggregationGroup: {
            name: 'monthly'
          }
        }, {
          id: 'HEAVY_API_CALLS_PER_MONTH',
          aggregationGroup: {
            name: 'monthly'
          },
          formula: 'SUM({HEAVY_API_CALL})',
          accumulate: function accumulate(a, qty) {
            return a ? a + qty : qty;
          },
          aggregate: function aggregate(a, qty) {
            return a ? a + qty : qty;
          }
        }]
      };

      var result = undefined,
          error = undefined;

      try {
        result = schemas.serviceDefinition.validate(service);
      } catch (e) {
        error = e;
      }

      expect(result).to.equal(undefined);
      expect(error).to.deep.equal({
        statusCode: 400,
        message: [{
          field: 'data.id',
          message: 'is required',
          value: service
        }, {
          field: 'data',
          message: 'has additional properties',
          value: 'data.service_id'
        }, {
          field: 'data.resources.0.units.0.quantityType',
          message: 'must be an enum value',
          value: 'INVALID'
        }, {
          field: 'data.resources.2.units.0.name',
          message: 'is required',
          value: service.resources[2].units[0]
        }, {
          field: 'data.aggregations.0.aggregationGroup.name',
          message: 'must be an enum value',
          value: 'invalid'
        }, {
          field: 'data.aggregations.1.id',
          message: 'is required',
          value: service.aggregations[1]
        }, {
          field: 'data.aggregations.1.formula',
          message: 'is required',
          value: service.aggregations[1]
        }, {
          field: 'data.aggregations.2.unit',
          message: 'is required',
          value: service.aggregations[2]
        }]
      });
    });
  });

  describe('validate usage submission schema for a service', function () {
    it('validate a valid usage record', function () {
      var usage = {
        service_instances: [{
          service_instance_id: '123',
          usage: [{
            start: 1420243200000,
            end: 1420245000000,
            plan_id: 'plan_123',
            organization_guid: 'org_456',
            space_guid: 'space_567',
            consumer: {
              type: 'external',
              value: '123'
            },
            resources: [{
              unit: 'calls',
              quantity: 12
            }]
          }]
        }]
      };

      expect(schemas.serviceUsage.validate(usage)).to.equal(usage);
    });

    it('validate an invalid usage record', function () {
      var usage = {
        id: '123',
        service_instances: [{
          usage: [{
            start: 1420243200000,
            end: 1420245000000,
            plan_id: 'plan_123',
            organization_guid: 'org_456',
            space_guid: 'space_567',
            consumer: {
              type: 'invalid',
              value: '123'
            },
            resources: [{
              quantity: 12
            }]
          }]
        }]
      };

      var result = undefined,
          error = undefined;

      try {
        result = schemas.serviceUsage.validate(usage);
      } catch (e) {
        error = e;
      }

      expect(result).to.equal(undefined);
      expect(error).to.deep.equal({
        statusCode: 400,
        message: [{
          field: 'data',
          message: 'has additional properties',
          value: 'data.id'
        }, {
          field: 'data.service_instances.0.service_instance_id',
          message: 'is required',
          value: usage.service_instances[0]
        }, {
          field: 'data.service_instances.0.usage.0.consumer.type',
          message: 'must be an enum value',
          value: 'invalid'
        }, {
          field: 'data.service_instances.0.usage.0.resources.0.unit',
          message: 'is required',
          value: usage.service_instances[0].usage[0].resources[0]
        }]
      });
    });
  });

  describe('validate usage submission schema for a service instance', function () {
    it('validate a valid usage record', function () {
      var usage = {
        service_id: '123',
        usage: [{
          start: 1420243200000,
          end: 1420245000000,
          plan_id: 'plan_123',
          organization_guid: 'org_456',
          space_guid: 'space_567',
          consumer: {
            type: 'external',
            value: '123'
          },
          resources: [{
            unit: 'calls',
            quantity: 12
          }]
        }]
      };
      expect(schemas.serviceInstanceUsage.validate(usage)).to.equal(usage);
    });

    it('validate an invalid usage record', function () {
      var usage = {
        id: '123',
        usage: [{
          start: '1420243200000',
          end: 1420245000000,
          plan_id: 'plan_123',
          organization_guid: 'org_456',
          space_guid: 'space_567',
          consumer: {
            type: 'external'
          },
          resources: [{
            unit: 'calls',
            quantity: '12'
          }]
        }]
      };

      var result = undefined,
          error = undefined;

      try {
        result = schemas.serviceInstanceUsage.validate(usage);
      } catch (e) {
        error = e;
      }

      expect(result).to.equal(undefined);
      expect(error).to.deep.equal({
        statusCode: 400,
        message: [{
          field: 'data.service_id',
          message: 'is required',
          value: usage
        }, {
          field: 'data',
          message: 'has additional properties',
          value: 'data.id'
        }, {
          field: 'data.usage.0.start',
          message: 'is the wrong type',
          value: '1420243200000'
        }, {
          field: 'data.usage.0.consumer.value',
          message: 'is required',
          value: usage.usage[0].consumer
        }, {
          field: 'data.usage.0.resources.0.quantity',
          message: 'is the wrong type',
          value: '12'
        }]
      });
    });
  });

  describe('validate usage submission schema for a runtime', function () {
    it('validate a valid usage record', function () {
      var usage = {
        usage: [{
          start: 1420243200000,
          end: 1420245000000,
          plan_id: 'plan_123',
          organization_guid: 'org_456',
          space_guid: 'space_567',
          consumer: {
            value: '123'
          },
          resources: [{
            unit: 'calls',
            quantity: 12
          }]
        }]
      };

      expect(schemas.runtimeUsage.validate(usage)).to.equal(usage);
    });

    it('validate an invalid usage record', function () {
      var usage = {
        id: '123',
        usage: [{
          end: 1420245000000,
          plan_id: 'plan_123',
          organization_guid: 'org_456',
          space_guid: 'space_567',
          consumer: {
            value: '123'
          },
          resources: [{
            unit: 1,
            quantity: 12
          }]
        }]
      };

      var result = undefined,
          error = undefined;

      try {
        result = schemas.runtimeUsage.validate(usage);
      } catch (e) {
        error = e;
      }

      expect(result).to.equal(undefined);
      expect(error).to.deep.equal({
        statusCode: 400,
        message: [{
          field: 'data',
          message: 'has additional properties',
          value: 'data.id'
        }, {
          field: 'data.usage.0.start',
          message: 'is required',
          value: usage.usage[0]
        }, {
          field: 'data.usage.0.resources.0.unit',
          message: 'is the wrong type',
          value: 1
        }]
      });
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0L3Rlc3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7O0FBSWIsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUU5QixRQUFRLENBQUMseUJBQXlCLEVBQUUsWUFBTTtBQUN4QyxVQUFRLENBQUMsbURBQW1ELEVBQUUsWUFBTTtBQUNsRSxNQUFFLENBQUMseUJBQXlCLEVBQUUsWUFBTTtBQUNsQyxVQUFNLE9BQU8sR0FBRztBQUNkLFVBQUUsRUFBRSxXQUFXO0FBQ2YsaUJBQVMsRUFBRSxDQUFDO0FBQ1YsY0FBSSxFQUFFLFNBQVM7QUFDZixlQUFLLEVBQUUsQ0FBQztBQUNOLGtCQUFNLEVBQUUsTUFBTTtBQUNkLHdCQUFZLEVBQUUsU0FBUztXQUN4QixDQUFDO1NBQ0gsRUFDQztBQUNFLGNBQUksRUFBRSxlQUFlO0FBQ3JCLGVBQUssRUFBRSxDQUFDO0FBQ04sZ0JBQUksRUFBRSxnQkFBZ0I7QUFDdEIsd0JBQVksRUFBRSxPQUFPO1dBQ3RCLENBQUM7U0FDSCxFQUNEO0FBQ0UsY0FBSSxFQUFFLGVBQWU7QUFDckIsZUFBSyxFQUFFLENBQUM7QUFDTixnQkFBSSxFQUFFLGdCQUFnQjtBQUN0Qix3QkFBWSxFQUFFLE9BQU87V0FDdEIsQ0FBQztTQUNILENBQUM7QUFDSixvQkFBWSxFQUFFLENBQUM7QUFDYixZQUFFLEVBQUUsbUJBQW1CO0FBQ3ZCLGNBQUksRUFBRSxVQUFVO0FBQ2hCLDBCQUFnQixFQUFFO0FBQ2hCLGdCQUFJLEVBQUUsU0FBUztXQUNoQjtBQUNELGlCQUFPLEVBQUUsd0JBQXdCO1NBQ2xDLEVBQ0M7QUFDRSxZQUFFLEVBQUUsb0NBQW9DO0FBQ3hDLGNBQUksRUFBRSxnQkFBZ0I7QUFDdEIsMEJBQWdCLEVBQUU7QUFDaEIsZ0JBQUksRUFBRSxTQUFTO1dBQ2hCO0FBQ0QsaUJBQU8sRUFBRSxpQkFBQyxDQUFDO21CQUFLLENBQUMsQ0FBQyxjQUFjLEdB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QyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8vIFRoZSBKU09OIHNjaGVtYXMgd2UgdXNlIHRvIHZhbGlkYXRlIHVzYWdlIGRhdGEgYW5kIHNlcnZpY2UgZGVmaW5pdGlvbnMuXG5cbmNvbnN0IHNjaGVtYXMgPSByZXF1aXJlKCcuLicpO1xuXG5kZXNjcmliZSgnYWJhY3VzLW1ldGVyaW5nLXNjaGVtYXMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCd2YWxpZGF0ZSBzY2hlbWEgZm9yIGEgc2VydmljZSByZXNvdXJjZSBkZWZpbml0aW9uJywgKCkgPT4ge1xuICAgIGl0KCd2YWxpZGF0ZSBhIHZhbGlkIHNjaGVtYScsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2UgPSB7XG4gICAgICAgIGlkOiAnc2VydmljZS0xJyxcbiAgICAgICAgcmVzb3VyY2VzOiBbe1xuICAgICAgICAgIG5hbWU6ICdTdG9yYWdlJyxcbiAgICAgICAgICB1bml0czogW3tcbiAgICAgICAgICAgICduYW1lJzogJ0JZVEUnLFxuICAgICAgICAgICAgcXVhbnRpdHlUeXBlOiAnQ1VSUkVOVCdcbiAgICAgICAgICB9XVxuICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdMaWdodEFwaUNhbGxzJyxcbiAgICAgICAgICAgIHVuaXRzOiBbe1xuICAgICAgICAgICAgICBuYW1lOiAnTElHSFRfQVBJX0NBTEwnLFxuICAgICAgICAgICAgICBxdWFudGl0eVR5cGU6ICdERUxUQSdcbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnSGVhdnlBcGlDYWxscycsXG4gICAgICAgICAgICB1bml0czogW3tcbiAgICAgICAgICAgICAgbmFtZTogJ0hFQVZZX0FQSV9DQUxMJyxcbiAgICAgICAgICAgICAgcXVhbnRpdHlUeXBlOiAnREVMVEEnXG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH1dLFxuICAgICAgICBhZ2dyZWdhdGlvbnM6IFt7XG4gICAgICAgICAgaWQ6ICdTVE9SQUdFX1BFUl9NT05USCcsXG4gICAgICAgICAgdW5pdDogJ0dJR0FCWVRFJyxcbiAgICAgICAgICBhZ2dyZWdhdGlvbkdyb3VwOiB7XG4gICAgICAgICAgICBuYW1lOiAnbW9udGhseSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvcm11bGE6ICdNQVgoe0JZVEV9LzEwNzM3NDE4MjQpJ1xuICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnVEhPVVNBTkRfTElHSFRfQVBJX0NBTExTX1BFUl9NT05USCcsXG4gICAgICAgICAgICB1bml0OiAnTElHSFRfQVBJX0NBTEwnLFxuICAgICAgICAgICAgYWdncmVnYXRpb25Hcm91cDoge1xuICAgICAgICAgICAgICBuYW1lOiAnbW9udGhseSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3JtdWxhOiAocikgPT4gci5MSUdIVF9BUElfQ0FMTCAvIDEwMDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAnSEVBVllfQVBJX0NBTExTX1BFUl9NT05USCcsXG4gICAgICAgICAgICB1bml0OiAnSEVBVllfQVBJX0NBTEwnLFxuICAgICAgICAgICAgYWdncmVnYXRpb25Hcm91cDoge1xuICAgICAgICAgICAgICBuYW1lOiAnbW9udGhseSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3JtdWxhOiAnU1VNKHtIRUFWWV9BUElfQ0FMTH0pJyxcbiAgICAgICAgICAgIGFjY3VtdWxhdGU6IChhLCBxdHkpID0+IGEgPyBhICsgcXR5IDogcXR5LFxuICAgICAgICAgICAgYWdncmVnYXRlOiAoYSwgcXR5KSA9PiBhID8gYSArIHF0eSA6IHF0eVxuICAgICAgICAgIH1dXG4gICAgICB9O1xuXG4gICAgICBleHBlY3Qoc2NoZW1hcy5zZXJ2aWNlRGVmaW5pdGlvbi52YWxpZGF0ZShzZXJ2aWNlKSkudG8uZXF1YWwoc2VydmljZSk7XG4gICAgfSk7XG5cbiAgICBpdCgndmFsaWRhdGUgYW4gaW52YWxpZCBzY2hlbWEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzZXJ2aWNlID0ge1xuICAgICAgICBzZXJ2aWNlX2lkOiAnc2VydmljZS0xJyxcbiAgICAgICAgcmVzb3VyY2VzOiBbe1xuICAgICAgICAgIG5hbWU6ICdTdG9yYWdlJyxcbiAgICAgICAgICB1bml0czogW3tcbiAgICAgICAgICAgICduYW1lJzogJ0JZVEUnLFxuICAgICAgICAgICAgcXVhbnRpdHlUeXBlOiAnSU5WQUxJRCdcbiAgICAgICAgICB9XVxuICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVuaXRzOiBbe1xuICAgICAgICAgICAgICBuYW1lOiAnTElHSFRfQVBJX0NBTEwnLFxuICAgICAgICAgICAgICBxdWFudGl0eVR5cGU6ICdERUxUQSdcbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnSGVhdnlBcGlDYWxscycsXG4gICAgICAgICAgICB1bml0czogW3tcbiAgICAgICAgICAgICAgcXVhbnRpdHlUeXBlOiAnREVMVEEnXG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH1dLFxuICAgICAgICBhZ2dyZWdhdGlvbnM6IFt7XG4gICAgICAgICAgaWQ6ICdTVE9SQUdFX1BFUl9NT05USCcsXG4gICAgICAgICAgdW5pdDogJ0dJR0FCWVRFJyxcbiAgICAgICAgICBhZ2dyZWdhdGlvbkdyb3VwOiB7XG4gICAgICAgICAgICBuYW1lOiAnaW52YWxpZCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvcm11bGE6ICdNQVgoe0JZVEV9LzEwNzM3NDE4MjQpJ1xuICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVuaXQ6ICdMSUdIVF9BUElfQ0FMTCcsXG4gICAgICAgICAgICBhZ2dyZWdhdGlvbkdyb3VwOiB7XG4gICAgICAgICAgICAgIG5hbWU6ICdtb250aGx5J1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICdIRUFWWV9BUElfQ0FMTFNfUEVSX01PTlRIJyxcbiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uR3JvdXA6IHtcbiAgICAgICAgICAgICAgbmFtZTogJ21vbnRobHknXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZm9ybXVsYTogJ1NVTSh7SEVBVllfQVBJX0NBTEx9KScsXG4gICAgICAgICAgICBhY2N1bXVsYXRlOiAoYSwgcXR5KSA9PiBhID8gYSArIHF0eSA6IHF0eSxcbiAgICAgICAgICAgIGFnZ3JlZ2F0ZTogKGEsIHF0eSkgPT4gYSA/IGEgKyBxdHkgOiBxdHlcbiAgICAgICAgICB9XVxuICAgICAgfTtcblxuICAgICAgbGV0IHJlc3VsdCwgZXJyb3I7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHJlc3VsdCA9IHNjaGVtYXMuc2VydmljZURlZmluaXRpb24udmFsaWRhdGUoc2VydmljZSk7XG4gICAgICB9XG4gICAgICBjYXRjaCAoZSkge1xuICAgICAgICBlcnJvciA9IGU7XG4gICAgICB9XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmVxdWFsKHVuZGVmaW5lZCk7XG4gICAgICBleHBlY3QoZXJyb3IpLnRvLmRlZXAuZXF1YWwoe1xuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICAgIG1lc3NhZ2U6IFt7XG4gICAgICAgICAgZmllbGQ6ICdkYXRhLmlkJyxcbiAgICAgICAgICBtZXNzYWdlOiAnaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIHZhbHVlOiBzZXJ2aWNlXG4gICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdkYXRhJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdoYXMgYWRkaXRpb25hbCBwcm9wZXJ0aWVzJyxcbiAgICAgICAgICAgIHZhbHVlOiAnZGF0YS5zZXJ2aWNlX2lkJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdkYXRhLnJlc291cmNlcy4wLnVuaXRzLjAucXVhbnRpdHlUeXBlJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdtdXN0IGJlIGFuIGVudW0gdmFsdWUnLFxuICAgICAgICAgICAgdmFsdWU6ICdJTlZBTElEJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdkYXRhLnJlc291cmNlcy4yLnVuaXRzLjAubmFtZScsXG4gICAgICAgICAgICBtZXNzYWdlOiAnaXMgcmVxdWlyZWQnLFxuICAgICAgICAgICAgdmFsdWU6IHNlcnZpY2UucmVzb3VyY2VzWzJdLnVuaXRzWzBdXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2RhdGEuYWdncmVnYXRpb25zLjAuYWdncmVnYXRpb25Hcm91cC5uYW1lJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdtdXN0IGJlIGFuIGVudW0gdmFsdWUnLFxuICAgICAgICAgICAgdmFsdWU6ICdpbnZhbGlkJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdkYXRhLmFnZ3JlZ2F0aW9ucy4xLmlkJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdpcyByZXF1aXJlZCcsXG4gICAgICAgICAgICB2YWx1ZTogc2VydmljZS5hZ2dyZWdhdGlvbnNbMV1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGF0YS5hZ2dyZWdhdGlvbnMuMS5mb3JtdWxhJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdpcyByZXF1aXJlZCcsXG4gICAgICAgICAgICB2YWx1ZTogc2VydmljZS5hZ2dyZWdhdGlvbnNbMV1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGF0YS5hZ2dyZWdhdGlvbnMuMi51bml0JyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdpcyByZXF1aXJlZCcsXG4gICAgICAgICAgICB2YWx1ZTogc2VydmljZS5hZ2dyZWdhdGlvbnNbMl1cbiAgICAgICAgICB9XVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZSB1c2FnZSBzdWJtaXNzaW9uIHNjaGVtYSBmb3IgYSBzZXJ2aWNlJywgKCkgPT4ge1xuICAgIGl0KCd2YWxpZGF0ZSBhIHZhbGlkIHVzYWdlIHJlY29yZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzYWdlID0ge1xuICAgICAgICBzZXJ2aWNlX2luc3RhbmNlczogW3tcbiAgICAgICAgICBzZXJ2aWNlX2luc3RhbmNlX2lkOiAnMTIzJyxcbiAgICAgICAgICB1c2FnZTogW3tcbiAgICAgICAgICAgIHN0YXJ0OiAxNDIwMjQzMjAwMDAwLFxuICAgICAgICAgICAgZW5kOiAxNDIwMjQ1MDAwMDAwLFxuICAgICAgICAgICAgcGxhbl9pZDogJ3BsYW5fMTIzJyxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbl9ndWlkOiAnb3JnXzQ1NicsXG4gICAgICAgICAgICBzcGFjZV9ndWlkOiAnc3BhY2VfNTY3JyxcbiAgICAgICAgICAgIGNvbnN1bWVyOiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdleHRlcm5hbCcsXG4gICAgICAgICAgICAgIHZhbHVlOiAnMTIzJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc291cmNlczogW3tcbiAgICAgICAgICAgICAgdW5pdDogJ2NhbGxzJyxcbiAgICAgICAgICAgICAgcXVhbnRpdHk6IDEyXG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH1dXG4gICAgICAgIH1dXG4gICAgICB9O1xuXG4gICAgICBleHBlY3Qoc2NoZW1hcy5zZXJ2aWNlVXNhZ2UudmFsaWRhdGUodXNhZ2UpKS50by5lcXVhbCh1c2FnZSk7XG4gICAgfSk7XG5cbiAgICBpdCgndmFsaWRhdGUgYW4gaW52YWxpZCB1c2FnZSByZWNvcmQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2FnZSA9IHtcbiAgICAgICAgaWQ6ICcxMjMnLFxuICAgICAgICBzZXJ2aWNlX2luc3RhbmNlczogW3tcbiAgICAgICAgICB1c2FnZTogW3tcbiAgICAgICAgICAgIHN0YXJ0OiAxNDIwMjQzMjAwMDAwLFxuICAgICAgICAgICAgZW5kOiAxNDIwMjQ1MDAwMDAwLFxuICAgICAgICAgICAgcGxhbl9pZDogJ3BsYW5fMTIzJyxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbl9ndWlkOiAnb3JnXzQ1NicsXG4gICAgICAgICAgICBzcGFjZV9ndWlkOiAnc3BhY2VfNTY3JyxcbiAgICAgICAgICAgIGNvbnN1bWVyOiB7XG4gICAgICAgICAgICAgIHR5cGU6ICdpbnZhbGlkJyxcbiAgICAgICAgICAgICAgdmFsdWU6ICcxMjMnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzb3VyY2VzOiBbe1xuICAgICAgICAgICAgICBxdWFudGl0eTogMTJcbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfV1cbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIGxldCByZXN1bHQsIGVycm9yO1xuXG4gICAgICB0cnkge1xuICAgICAgICByZXN1bHQgPSBzY2hlbWFzLnNlcnZpY2VVc2FnZS52YWxpZGF0ZSh1c2FnZSk7XG4gICAgICB9XG4gICAgICBjYXRjaCAoZSkge1xuICAgICAgICBlcnJvciA9IGU7XG4gICAgICB9XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmVxdWFsKHVuZGVmaW5lZCk7XG4gICAgICBleHBlY3QoZXJyb3IpLnRvLmRlZXAuZXF1YWwoe1xuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICAgIG1lc3NhZ2U6IFt7XG4gICAgICAgICAgZmllbGQ6ICdkYXRhJyxcbiAgICAgICAgICBtZXNzYWdlOiAnaGFzIGFkZGl0aW9uYWwgcHJvcGVydGllcycsXG4gICAgICAgICAgdmFsdWU6ICdkYXRhLmlkJ1xuICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGF0YS5zZXJ2aWNlX2luc3RhbmNlcy4wLnNlcnZpY2VfaW5zdGFuY2VfaWQnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ2lzIHJlcXVpcmVkJyxcbiAgICAgICAgICAgIHZhbHVlOiB1c2FnZS5zZXJ2aWNlX2luc3RhbmNlc1swXVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdkYXRhLnNlcnZpY2VfaW5zdGFuY2VzLjAudXNhZ2UuMC5jb25zdW1lci50eXBlJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdtdXN0IGJlIGFuIGVudW0gdmFsdWUnLFxuICAgICAgICAgICAgdmFsdWU6ICdpbnZhbGlkJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdkYXRhLnNlcnZpY2VfaW5zdGFuY2VzLjAudXNhZ2UuMC5yZXNvdXJjZXMuMC51bml0JyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdpcyByZXF1aXJlZCcsXG4gICAgICAgICAgICB2YWx1ZTogdXNhZ2Uuc2VydmljZV9pbnN0YW5jZXNbMF0udXNhZ2VbMF0ucmVzb3VyY2VzWzBdXG4gICAgICAgICAgfV1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGUgdXNhZ2Ugc3VibWlzc2lvbiBzY2hlbWEgZm9yIGEgc2VydmljZSBpbnN0YW5jZScsICgpID0+IHtcbiAgICBpdCgndmFsaWRhdGUgYSB2YWxpZCB1c2FnZSByZWNvcmQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2FnZSA9IHtcbiAgICAgICAgc2VydmljZV9pZDogJzEyMycsXG4gICAgICAgIHVzYWdlOiBbe1xuICAgICAgICAgIHN0YXJ0OiAxNDIwMjQzMjAwMDAwLFxuICAgICAgICAgIGVuZDogMTQyMDI0NTAwMDAwMCxcbiAgICAgICAgICBwbGFuX2lkOiAncGxhbl8xMjMnLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbl9ndWlkOiAnb3JnXzQ1NicsXG4gICAgICAgICAgc3BhY2VfZ3VpZDogJ3NwYWNlXzU2NycsXG4gICAgICAgICAgY29uc3VtZXI6IHtcbiAgICAgICAgICAgIHR5cGU6ICdleHRlcm5hbCcsXG4gICAgICAgICAgICB2YWx1ZTogJzEyMydcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlc291cmNlczogW3tcbiAgICAgICAgICAgIHVuaXQ6ICdjYWxscycsXG4gICAgICAgICAgICBxdWFudGl0eTogMTJcbiAgICAgICAgICB9XVxuICAgICAgICB9XVxuICAgICAgfTtcbiAgICAgIGV4cGVjdChzY2hlbWFzLnNlcnZpY2VJbnN0YW5jZVVzYWdlLnZhbGlkYXRlKHVzYWdlKSkudG8uZXF1YWwodXNhZ2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3ZhbGlkYXRlIGFuIGludmFsaWQgdXNhZ2UgcmVjb3JkJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNhZ2UgPSB7XG4gICAgICAgIGlkOiAnMTIzJyxcbiAgICAgICAgdXNhZ2U6IFt7XG4gICAgICAgICAgc3RhcnQ6ICcxNDIwMjQzMjAwMDAwJyxcbiAgICAgICAgICBlbmQ6IDE0MjAyNDUwMDAwMDAsXG4gICAgICAgICAgcGxhbl9pZDogJ3BsYW5fMTIzJyxcbiAgICAgICAgICBvcmdhbml6YXRpb25fZ3VpZDogJ29yZ180NTYnLFxuICAgICAgICAgIHNwYWNlX2d1aWQ6ICdzcGFjZV81NjcnLFxuICAgICAgICAgIGNvbnN1bWVyOiB7XG4gICAgICAgICAgICB0eXBlOiAnZXh0ZXJuYWwnXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXNvdXJjZXM6IFt7XG4gICAgICAgICAgICB1bml0OiAnY2FsbHMnLFxuICAgICAgICAgICAgcXVhbnRpdHk6ICcxMidcbiAgICAgICAgICB9XVxuICAgICAgICB9XVxuICAgICAgfTtcblxuICAgICAgbGV0IHJlc3VsdCwgZXJyb3I7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHJlc3VsdCA9IHNjaGVtYXMuc2VydmljZUluc3RhbmNlVXNhZ2UudmFsaWRhdGUodXNhZ2UpO1xuICAgICAgfVxuICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgZXJyb3IgPSBlO1xuICAgICAgfVxuXG4gICAgICBleHBlY3QocmVzdWx0KS50by5lcXVhbCh1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KGVycm9yKS50by5kZWVwLmVxdWFsKHtcbiAgICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgICAgICBtZXNzYWdlOiBbe1xuICAgICAgICAgIGZpZWxkOiAnZGF0YS5zZXJ2aWNlX2lkJyxcbiAgICAgICAgICBtZXNzYWdlOiAnaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIHZhbHVlOiB1c2FnZVxuICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnZGF0YScsXG4gICAgICAgICAgICBtZXNzYWdlOiAnaGFzIGFkZGl0aW9uYWwgcHJvcGVydGllcycsXG4gICAgICAgICAgICB2YWx1ZTogJ2RhdGEuaWQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2RhdGEudXNhZ2UuMC5zdGFydCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnaXMgdGhlIHdyb25nIHR5cGUnLFxuICAgICAgICAgICAgdmFsdWU6ICcxNDIwMjQzMjAwMDAwJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdkYXRhLnVzYWdlLjAuY29uc3VtZXIudmFsdWUnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ2lzIHJlcXVpcmVkJyxcbiAgICAgICAgICAgIHZhbHVlOiB1c2FnZS51c2FnZVswXS5jb25zdW1lclxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdkYXRhLnVzYWdlLjAucmVzb3VyY2VzLjAucXVhbnRpdHknLFxuICAgICAgICAgICAgbWVzc2FnZTogJ2lzIHRoZSB3cm9uZyB0eXBlJyxcbiAgICAgICAgICAgIHZhbHVlOiAnMTInXG4gICAgICAgICAgfV1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGUgdXNhZ2Ugc3VibWlzc2lvbiBzY2hlbWEgZm9yIGEgcnVudGltZScsICgpID0+IHtcbiAgICBpdCgndmFsaWRhdGUgYSB2YWxpZCB1c2FnZSByZWNvcmQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2FnZSA9IHtcbiAgICAgICAgdXNhZ2U6IFt7XG4gICAgICAgICAgc3RhcnQ6IDE0MjAyNDMyMDAwMDAsXG4gICAgICAgICAgZW5kOiAxNDIwMjQ1MDAwMDAwLFxuICAgICAgICAgIHBsYW5faWQ6ICdwbGFuXzEyMycsXG4gICAgICAgICAgb3JnYW5pemF0aW9uX2d1aWQ6ICdvcmdfNDU2JyxcbiAgICAgICAgICBzcGFjZV9ndWlkOiAnc3BhY2VfNTY3JyxcbiAgICAgICAgICBjb25zdW1lcjoge1xuICAgICAgICAgICAgdmFsdWU6ICcxMjMnXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXNvdXJjZXM6IFt7XG4gICAgICAgICAgICB1bml0OiAnY2FsbHMnLFxuICAgICAgICAgICAgcXVhbnRpdHk6IDEyXG4gICAgICAgICAgfV1cbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIGV4cGVjdChzY2hlbWFzLnJ1bnRpbWVVc2FnZS52YWxpZGF0ZSh1c2FnZSkpLnRvLmVxdWFsKHVzYWdlKTtcbiAgICB9KTtcblxuICAgIGl0KCd2YWxpZGF0ZSBhbiBpbnZhbGlkIHVzYWdlIHJlY29yZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzYWdlID0ge1xuICAgICAgICBpZDogJzEyMycsXG4gICAgICAgIHVzYWdlOiBbe1xuICAgICAgICAgIGVuZDogMTQyMDI0NTAwMDAwMCxcbiAgICAgICAgICBwbGFuX2lkOiAncGxhbl8xMjMnLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbl9ndWlkOiAnb3JnXzQ1NicsXG4gICAgICAgICAgc3BhY2VfZ3VpZDogJ3NwYWNlXzU2NycsXG4gICAgICAgICAgY29uc3VtZXI6IHtcbiAgICAgICAgICAgIHZhbHVlOiAnMTIzJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbe1xuICAgICAgICAgICAgdW5pdDogMSxcbiAgICAgICAgICAgIHF1YW50aXR5OiAxMlxuICAgICAgICAgIH1dXG4gICAgICAgIH1dXG4gICAgICB9O1xuXG4gICAgICBsZXQgcmVzdWx0LCBlcnJvcjtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzdWx0ID0gc2NoZW1hcy5ydW50aW1lVXNhZ2UudmFsaWRhdGUodXNhZ2UpO1xuICAgICAgfVxuICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgZXJyb3IgPSBlO1xuICAgICAgfVxuXG4gICAgICBleHBlY3QocmVzdWx0KS50by5lcXVhbCh1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KGVycm9yKS50by5kZWVwLmVxdWFsKHtcbiAgICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgICAgICBtZXNzYWdlOiBbe1xuICAgICAgICAgIGZpZWxkOiAnZGF0YScsXG4gICAgICAgICAgbWVzc2FnZTogJ2hhcyBhZGRpdGlvbmFsIHByb3BlcnRpZXMnLFxuICAgICAgICAgIHZhbHVlOiAnZGF0YS5pZCdcbiAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2RhdGEudXNhZ2UuMC5zdGFydCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnaXMgcmVxdWlyZWQnLFxuICAgICAgICAgICAgdmFsdWU6IHVzYWdlLnVzYWdlWzBdXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2RhdGEudXNhZ2UuMC5yZXNvdXJjZXMuMC51bml0JyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdpcyB0aGUgd3JvbmcgdHlwZScsXG4gICAgICAgICAgICB2YWx1ZTogMVxuICAgICAgICAgIH1dXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuIl19